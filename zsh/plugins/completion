#!/usr/bin/env zsh
# zsh補完システムの設定

# =============================================================================
# 基本的な補完設定
# =============================================================================

# 補完の表示設定
zstyle ':completion:*' menu select                      # メニュー形式で補完候補を選択
zstyle ':completion:*' list-colors ${(s.:.)LS_COLORS}  # 補完候補に色を付ける

# 補完候補のグループ化とフォーマット
zstyle ':completion:*' group-name ''                    # グループ名を表示
zstyle ':completion:*:descriptions' format '%B%F{yellow}--- %d ---%f%b'
zstyle ':completion:*:messages' format '%B%F{red}%d%f%b'
zstyle ':completion:*:warnings' format '%B%F{red}No matches for: %d%f%b'


# 補完の詳細表示
zstyle ':completion:*' verbose true                     # 詳細な説明を表示
zstyle ':completion:*:options' description yes          # オプションの説明を表示

# プロセス関連
zstyle ':completion:*:processes' command 'ps -u $USER -o pid,stat,%cpu,%mem,command -w'
zstyle ':completion:*:*:kill:*:processes' list-colors '=(#b) #([0-9]#)*=0=01;31'

# =============================================================================
# Git特有の設定
# =============================================================================

# 既存の設定を維持（JIRAタイトル表示のため）
zstyle ':completion:*:git-checkout:*' list-packed true
zstyle ':completion:*:git-switch:*' list-packed true  
zstyle ':completion:*:git-branch:*' list-packed true

# 追加のGit設定
zstyle ':completion:*:git-*:*' tag-order 'heads'       # ブランチを優先表示

# =============================================================================
# ディレクトリ補完
# =============================================================================

# cd の補完設定
zstyle ':completion:*:cd:*' tag-order local-directories directory-stack path-directories
zstyle ':completion:*:cd:*' ignore-parents parent pwd  # 親ディレクトリを無視

# ディレクトリを先に表示（GNU lsが必要）
# zstyle ':completion:*' list-dirs-first true

# =============================================================================
# その他の便利な設定
# =============================================================================

# sudo の後でもコマンド補完を有効にする
zstyle ':completion:*:sudo:*' command-path /usr/local/sbin /usr/local/bin /usr/sbin /usr/bin /sbin /bin

# ファイル名の補完で、隠しファイルも候補に含める
# 注意: これを有効にすると常に隠しファイルが表示される
# zstyle ':completion:*' file-patterns '*:all-files'

# 補完時のマッチング設定（段階的に適用）
# 1. まず完全一致を試す
# 2. 大文字小文字とハイフン/アンダースコアを区別しない
# 3. ワード境界での部分マッチを許可
zstyle ':completion:*' matcher-list '' 'm:{a-z-_}={A-Z_-}' 'r:|[._-]=* r:|=* l:|=*'

# =============================================================================
# オプション設定（コメントアウト状態で提供）
# =============================================================================

# 全体的に補完候補を詰めて表示したい場合
# zstyle ':completion:*' list-packed true

# 補完候補が1つしかない場合でも表示する
# zstyle ':completion:*' menu yes=long

# 補完候補を絞り込む際の最小文字数
# zstyle ':completion:*' min-input 3

# ホスト名の補完（ssh等で使用）
# zstyle ':completion:*:hosts' hosts $(awk '/^[^#]/ {print $2}' ~/.ssh/known_hosts 2>/dev/null)