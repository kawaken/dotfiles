#!/bin/zsh

WORKTREE_DIR="$1"
SCRIPT_DIR="$(cd "$(dirname "$0")" && pwd)"

cp -v -i "$SCRIPT_DIR/backend/.env" "$WORKTREE_DIR/backend/"

# gitignore対象ファイルを同期
(cd "$WORKTREE_DIR" && gw sync --to-worktree)

# Claude Code: trust worktree directory
cp ~/.claude.json ~/.claude.json.bk
jq --arg path "$WORKTREE_DIR" '.projects[$path].hasTrustDialogAccepted = true' ~/.claude.json.bk > ~/.claude.json

mise trust "$WORKTREE_DIR/"
