#!/usr/bin/env zsh

set -euo pipefail

DATA_DIR="${XDG_DATA_HOME:-$HOME/.local/share}/jira-sync"
DATA_FILE="$DATA_DIR/current_sprint_issues.json"

mkdir -p "$DATA_DIR"


cleanup() {
    exit 0
}

trap cleanup SIGTERM SIGINT

update_issues() {
    # 新しいjiraコマンドで--rawオプションを使用してJSONを保存
    ~/go/bin/jira issue list \
        --jql="Sprint in openSprints() AND status != Done AND type != エピック" \
        --raw \
        > "$DATA_FILE"
}

while true; do
    update_issues
    sleep 300
done